import{j as e,u as $,R as q,r as A,f as D,b as R,c as T,y as O}from"./app-ea79898d.js";import{A as F,d as N,a as g}from"./AuthenticatedLayout-f288b57f.js";import{i as a}from"./chunk-TC4QW7OA-a4b172da.js";import{P as K}from"./PlusIcon-d746d68d.js";import{u as V,a as E}from"./index.esm-a4560a11.js";import{m as L,b as p}from"./chunk-NXTXE2B3-9935a125.js";import{s as B,l as Q}from"./chunk-ZFWMN6TD-4dd0050c.js";import"./transition-0b40ee33.js";import"./import-d434d177.js";function z({register:m,index:l,handleRemove:f,handlePriceChange:r,getValues:y,handleQuantityChange:b}){return e.jsx("div",{children:e.jsxs("div",{className:" flex dark:text-white justify-between space-x-5 items-center",children:[e.jsxs("div",{className:" flex flex-wrap  w-full   ",children:[e.jsx("div",{className:" flex-1 flex px-2   flex-col  ",children:e.jsx("div",{className:" flex px-2   flex-1  flex-col items-start",children:e.jsx(a,{style:{border:"none",outline:"none",boxShadow:"none"},type:"text",label:"Description.",labelPlacement:"outside",startContent:"🧮",onChange:i=>b(l,i),...m(`items.${l}.description`)})})}),e.jsx("div",{className:" flex px-2   flex-1  flex-col items-start",children:e.jsx(a,{style:{border:"none",outline:"none",boxShadow:"none"},type:"number",label:"Qty.",labelPlacement:"outside",startContent:"🧮",onChange:i=>b(l,i)})}),e.jsx("div",{className:" flex px-2 flex-1  flex-col items-start",children:e.jsx(a,{style:{border:"none",outline:"none",boxShadow:"none"},type:"number",label:"Rate",labelPlacement:"outside",onChange:i=>r(l,i),startContent:"K"})}),e.jsx("div",{className:" flex px-2 flex-1  flex-col items-start",children:e.jsx(a,{style:{border:"none",outline:"none",boxShadow:"none"},type:"number",className:"bg-white dark:bg-[#1e2139]",isReadOnly:!0,label:"Amount.",labelPlacement:"outside",startContent:"K",bgColor:"white",...m(`items.${l}.amount`)})})]}),e.jsx("button",{className:"pt-8",onClick:()=>{f(l)},children:"🗑️"})]})})}function se({auth:m}){const l=$(),f=[{description:"",quantity:0,rate:0,amount:0}],r=V({defaultValues:{invoiceNumber:0,client:0,date:new Date().toISOString().slice(0,10),due_date:new Date().toISOString().slice(0,10),truck_plate:"",subtotal:0,invoicetotal:0,items:f}}),{fields:y,append:b,remove:i}=E({control:r.control,name:"items"}),{register:n,reset:v,setValue:c,getValues:o,handleSubmit:G}=r,w=(t,s)=>{const u=parseInt(s.target.value);c(`items.${t}.rate`,u);const d=o(`items.${t}.quantity`),x=o(`items.${t}.rate`),h=d*x;c(`items.${t}.amount`,h),j()},S=(t,s)=>{const u=parseInt(s.target.value);c(`items.${t}.quantity`,u);const d=o(`items.${t}.quantity`),x=o(`items.${t}.rate`),h=d*x;console.log("total :","qty",d,h),c(`items.${t}.amount`,h),j()},j=()=>{const s=o("items").reduce((d,x)=>d+x.amount,0);c("subtotal",s);const u=o("subtotal")+o("subtotal")*.16;c("invoicetotal",u)},C=t=>{i(t)},I=()=>{b({description:"",quantity:0,rate:0,amount:0,id:""})},[P,H]=q.useState(!1),_=async t=>{console.log(t),T.post("/invoices",t).then(s=>{console.log("res :",s),g.success("Invoice Added Successfully"),O.visit("/invoices"),v()}).catch(s=>{console.log("err :",s),g.error("Failed to create an Invoice")})};A.useEffect(()=>{l(D())},[l]);const k=R(t=>t.customers.customers);return e.jsx(F,{user:m.user,header:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Create Invoice"}),children:e.jsxs(L.div,{initial:{x:-500,opacity:0},animate:{opacity:1,x:0,transition:{type:"spring",stiffness:300,damping:40,duration:.4}},exit:{x:-700,transition:{duration:.2}},className:"  scrollbar-hide flex flex-col dark:text-white dark:bg-[#141625] bg-white my-5  md:pl-[50px] py-16 px-6 h-screen md:w-full md:rounded-r-3xl",children:[e.jsx("h1",{className:" font-semibold dark:text-white  text-3xl",children:"Create Invoice"}),e.jsxs("form",{className:"overflow-y-scroll relative scrollbar-hide ",onSubmit:r.handleSubmit(_),children:[e.jsx("div",{className:"  ",children:e.jsxs("div",{className:" ",children:[e.jsx("h1",{className:"my-4 mt-5 font-medium",children:"Bill To"}),e.jsx(N,{className:"my-5"}),e.jsxs("div",{className:" grid grid-cols-2   gap-3   ",children:[e.jsx("div",{className:" mx-1 col-span-1 ",children:e.jsx(a,{style:{border:"none",outline:"none",boxShadow:"none"},type:"text",label:"Invoice No#",labelPlacement:"outside",startContent:"#",className:" ",...n("invoiceNumber")},"invoiceNumber")}),e.jsx("div",{className:"  col-span-1",children:e.jsx(B,{labelPlacement:"outside",label:"Client Name",className:" ",startContent:"👤",...n("client"),children:k.map(t=>e.jsx(Q,{value:t.id,children:t.company_name},t.id))})})]}),e.jsxs("div",{className:" flex justify-center space-x-5 items-center mt-8 ",children:[e.jsx("div",{className:" flex-1  ",children:e.jsx(a,{style:{border:"none",outline:"none",boxShadow:"none"},type:"date",label:"Invoice Date",labelPlacement:"outside",startContent:"🗓️",...n("date")},"date")}),e.jsx("div",{className:"flex-1  ",children:e.jsx(a,{style:{border:"none",outline:"none",boxShadow:"none"},type:"date",label:"Due Date",labelPlacement:"outside",startContent:"🗓️",...n("due_date")},"date")})]}),e.jsx("div",{className:" mx-1 mt-6 flex flex-col ",children:e.jsx(a,{style:{border:"none",outline:"none",boxShadow:"none"},type:"text",label:"Truck Plate Number",labelPlacement:"outside",startContent:"🚚",className:"",...n("truck_plate")},"transport")}),e.jsx("h2",{className:" font-medium text-gray-500 mt-10 ",children:"Item List"}),e.jsx(N,{className:"my-5"}),y.map(({id:t},s)=>e.jsx("div",{className:" border-b pb-2 border-gray-300 mb-4 ",children:e.jsx(z,{handleRemove:C,handlePriceChange:w,getValues:o,control:r.control,handleQuantityChange:S,index:s,name:`items.${s}.name`,register:n},s)},s)),e.jsxs("div",{className:"flex flex-col   items-end",children:[e.jsx(a,{style:{border:"none",outline:"none",boxShadow:"none"},type:"text",isReadOnly:!0,label:"Sub Total",labelPlacement:"outside",startContent:"K",className:"w-fit float-right",...n("subtotal")},"Sub Total"),e.jsx(a,{style:{border:"none",outline:"none",boxShadow:"none"},type:"text",value:"16",labelPlacement:"outside",startContent:"%",className:"w-fit my-5 float-right"},"vat"),e.jsx(a,{style:{border:"none",outline:"none",boxShadow:"none"},isReadOnly:!0,type:"text",label:"Invoice Total",labelPlacement:"outside",startContent:"K",className:"w-fit float-right",...n("invoicetotal")},"invoiceTotal"),e.jsx("input",{type:"hidden",...n("issued_by",{value:m.user.id})})]})]})}),e.jsxs("div",{className:"sticky space-y-4",children:[e.jsx(p,{onClick:()=>{I()},className:"  w-full mt-4",color:"primary",endContent:e.jsx(K,{}),children:"Add New Item"}),e.jsxs("div",{className:" flex  justify-between",children:[e.jsx("div",{children:e.jsx(p,{onClick:()=>{v()},className:"  ",color:"primary",children:"Discard"})}),e.jsx("div",{children:e.jsx(p,{className:"  ",color:"primary",type:"submit",isLoading:P,children:"Submit"})})]})]})]})]},"createInvoice-sidebar")})}export{se as default};
