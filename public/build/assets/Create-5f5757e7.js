import{u as q,R as E,r as F,f as P,b as R,j as e,c as N,y as g}from"./app-48a49514.js";import{A as V,d as v,a as x}from"./AuthenticatedLayout-a8dbafd3.js";import{I as J}from"./InvoiceField-7c2659b6.js";import{P as L}from"./PlusIcon-969fe0ee.js";import{u as M,a as U}from"./index.esm-936b9fa4.js";import{I as p}from"./InputText-085e48c9.js";import{m as B,b as f}from"./chunk-NXTXE2B3-2e72370c.js";import"./transition-bcfe5a6e.js";function te({auth:b,invoice:t}){const y=q(),I=[{description:"",quantity:0,rate:0,amount:0}],u=M({defaultValues:{invoiceNumber:t&&t.number?t.number:0,client:t&&t.customer?t.customer:0,date:t&&t.date?t.date:new Date().toISOString().slice(0,10),due_date:t&&t.due_date?t.due_date:new Date().toISOString().slice(0,10),truck_plate:t&&t.track_details?t.track_details:"",subtotal:t&&t.subtotal?t.subtotal:0,invoicetotal:t&&t.total?t.total:0,items:t&&t.line_items?JSON.parse(t.line_items):I,vat:t&&t.vat?t.subtotal*.16:0}}),{register:r,reset:h,setValue:i,getValues:o,handleSubmit:Q}=u,{fields:S,append:w,remove:_}=U({control:u.control,name:"items"}),C=(s,a)=>{const l=parseFloat(a.target.value);i(`items.${s}.rate`,l);const n=o(`items.${s}.quantity`),d=o(`items.${s}.rate`),m=c(n*d,3);i(`items.${s}.amount`,m),j()},T=(s,a)=>{const l=parseInt(a.target.value);i(`items.${s}.quantity`,l);const n=o(`items.${s}.quantity`),d=o(`items.${s}.rate`),m=c(n*d,3);i(`items.${s}.amount`,m),j()},c=(s,a)=>{const l=Math.pow(10,a);return Math.round(s*l)/l},j=()=>{const s=o("items"),a=c(s.reduce((d,m)=>d+m.amount,0),3);i("subtotal",a);const l=c(o("subtotal")+o("subtotal")*.16,3),n=c(o("subtotal")*.16,3);i("vat",n),i("invoicetotal",l)},A=s=>{_(s)},D=()=>{w({description:"",quantity:0,rate:0,amount:0,id:""})},[$,z]=E.useState(!1),k=async s=>{if(t&&t.id){const a=new FormData;Object.entries(s).forEach(([l,n])=>{l==="items"&&Array.isArray(n)?a.append(l,JSON.stringify(n)):a.append(l,n)}),a.append("_method","PUT"),N.post(`/invoices/${t.id}`,a).then(l=>{console.log("res:",l),x.success("Invoice Edited Successfully"),h(),g.visit("/invoices")}).catch(l=>{console.error("err:",l),x.error("Failed to edit the Invoice")})}else N.post("/invoices",s).then(a=>{x.success("Invoice Added Successfully"),g.visit("/invoices"),h()}).catch(a=>{console.error("err:",a),x.error("Failed to create an Invoice")})};F.useEffect(()=>{y(P())},[y]);const O=R(s=>s.customers.customers);return e.jsx(V,{user:b.user,header:e.jsxs("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:[t?"Edit":"Create"," Invoice"]}),children:e.jsxs(B.div,{initial:{x:-500,opacity:0},animate:{opacity:1,x:0,transition:{type:"spring",stiffness:300,damping:40,duration:.4}},exit:{x:-700,transition:{duration:.2}},className:"  scrollbar-hide flex flex-col dark:text-white dark:bg-[#141625] bg-white my-5  md:pl-[50px] py-16 px-6 h-screen md:w-full md:rounded-r-3xl",children:[e.jsxs("h1",{className:" font-semibold dark:text-white  text-3xl",children:[t?"Edit":"Create"," Invoice"]}),e.jsxs("form",{className:"overflow-y-scroll relative scrollbar-hide ",onSubmit:u.handleSubmit(k),children:[e.jsx("div",{className:"  ",children:e.jsxs("div",{className:" ",children:[e.jsx("h1",{className:"my-4 mt-5 font-medium",children:"Bill To"}),e.jsx(v,{className:"my-5"}),e.jsxs("div",{className:" grid grid-cols-2   gap-3   ",children:[e.jsx("div",{className:" mx-1 col-span-1 ",children:e.jsx(p,{title:"Inoivce Number",type:"text",register:r,name:"invoiceNumber"})}),e.jsxs("div",{className:"  col-span-1",children:[e.jsx("span",{children:"Client"}),e.jsxs("select",{labelPlacement:"outside",label:"Client Name",className:"bg-gray-100  mt-1 p-2 rounded-xl w-full border-none outline-none focus:ring-0",startContent:"ðŸ‘¤",...r("client"),children:[e.jsx("option",{value:""}),O.map(s=>e.jsx("option",{value:s.id,children:s.company_name},s.id))]})]})]}),e.jsxs("div",{className:" flex justify-center space-x-5 items-center mt-8 ",children:[e.jsx("div",{className:" flex-1  ",children:e.jsx(p,{title:"Date ",className:"flex-1",type:"date",register:r,name:"date"})}),e.jsx("div",{className:"flex-1  ",children:e.jsx(p,{title:"Due Date",className:"flex-1",type:"date",register:r,name:"due_date"})})]}),e.jsx("div",{className:" mx-1 mt-6 flex flex-col ",children:e.jsx(p,{title:"Truck Plate Number",className:"flex-1",type:"text",register:r,name:"truck_plate"})}),e.jsx("h2",{className:" font-medium text-gray-500 mt-10 ",children:"Item List"}),e.jsx(v,{className:"my-5"}),S.map(({id:s},a)=>e.jsx("div",{className:" border-b pb-2 border-gray-300 mb-4 ",children:e.jsx(J,{handleRemove:A,handlePriceChange:C,getValues:o,control:u.control,handleQuantityChange:T,index:a,name:`items.${a}.name`,register:r},a)},a)),e.jsxs("div",{className:"flex flex-col text-left   items-end",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm float-left",children:"Sub Total"}),e.jsx("input",{style:{border:"none",outline:"none",boxShadow:"none"},type:"text",readOnly:!0,className:"bg-gray-100  mt-1 p-2 rounded-xl w-fit float-right",...r("subtotal")},"Sub Total")]}),e.jsxs("div",{className:"flex my-3 flex-col",children:[e.jsx("span",{className:"text-sm text-left",children:"VAT (16%)"}),e.jsx("input",{style:{border:"none",outline:"none",boxShadow:"none"},type:"text",readOnly:!0,className:" bg-gray-100 w-fit mt-1 p-2 rounded-xl  float-right",...r("vat")},"vat")]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm",children:"Invoice Total"}),e.jsx("input",{style:{border:"none",outline:"none",boxShadow:"none"},isReadOnly:!0,readOnly:!0,className:"bg-gray-100 w-fit mt-1 p-2 rounded-xl float-right",...r("invoicetotal")},"invoiceTotal")]}),e.jsx("input",{type:"hidden",...r("issued_by",{value:b.user.id})})]})]})}),e.jsxs("div",{className:"sticky space-y-4",children:[e.jsx(f,{onClick:()=>{D()},className:"  w-full mt-4",color:"primary",endContent:e.jsx(L,{}),children:"Add New Item"}),e.jsxs("div",{className:" flex  justify-between",children:[e.jsx("div",{children:e.jsx(f,{onClick:()=>{h()},className:"  ",color:"primary",children:"Discard"})}),e.jsx("div",{children:e.jsx(f,{className:"  ",color:"primary",type:"submit",isLoading:$,children:t?"Update":"Create"})})]})]})]})]},"createInvoice-sidebar")})}export{te as default};
