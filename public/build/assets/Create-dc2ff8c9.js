import{j as e,u as A,R as E,r as k,f as F,i as O,b as f,c as h,y as j}from"./app-cc386e44.js";import{A as P,d as b,a as o}from"./AuthenticatedLayout-8bf23479.js";import{I as c}from"./InputText-6ecb40c9.js";import{P as R}from"./PlusIcon-ff3ca88b.js";import{u as V,a as $}from"./index.esm-cf56efac.js";import{j as q,b as u}from"./chunk-NXTXE2B3-6348f185.js";function J({register:n,index:s,handleRemove:r,getValues:p}){return e.jsx("div",{children:e.jsxs("div",{className:" flex dark:text-white justify-between space-x-5 items-center",children:[e.jsxs("div",{className:" flex flex-wrap  w-full   ",children:[e.jsx("div",{className:" flex-1 flex px-2   flex-col  ",children:e.jsx("div",{className:" flex px-2   flex-1  flex-col items-start",children:e.jsx(c,{title:"Description",type:"text",register:n,name:`items.${s}.description`})})}),e.jsx("div",{className:" flex px-2   flex-1  flex-col items-start",children:e.jsx(c,{title:"Qty",type:"number",register:n,name:`items.${s}.quantity`})})]}),e.jsx("button",{className:"pt-8",onClick:()=>{r(s)},children:"🗑️"})]})})}function M({auth:n,deliveryNote:s}){const r=A(),p=[{description:"",quantity:0}],d=V({defaultValues:{invoice:s?s.invoice_id:0,client:s?s.client_id:0,date:s?s.date:new Date().toISOString().slice(0,10),issue_date:s?s.issue_date:new Date().toISOString().slice(0,10),number:s?s.number:"",items:s?JSON.parse(s.items):p}}),{fields:y,append:v,remove:N}=$({control:d.control,name:"items"}),{register:a,reset:m,setValue:L,getValues:g,handleSubmit:T}=d,D=t=>{N(t)},S=()=>{v({description:"",quantity:0,id:""})},[w,Q]=E.useState(!1),I=async t=>{if(s&&s.id){const i=new FormData;Object.entries(t).forEach(([l,x])=>{l==="items"&&Array.isArray(x)?i.append(l,JSON.stringify(x)):i.append(l,x)}),i.append("_method","PUT"),h.post(`/delivery-notes/${s.id}`,i).then(l=>{o.success("Delivery Note Edited Successfully"),m(),j.visit("/delivery-notes")}).catch(l=>{console.error("Error editing delivery note:",l),o.error("Failed to edit delivery note")})}else h.post("/delivery-notes",t).then(i=>{o.success("Delivery Note Added Successfully"),m(),j.visit("/delivery-notes")}).catch(i=>{console.error("Error adding delivery note:",i),o.error("Failed to add delivery note")})};k.useEffect(()=>{r(F()),r(O())},[r]);const C=f(t=>t.customers.customers),_=f(t=>t.invoices.invoices);return e.jsx(P,{user:n.user,header:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:s?"Edit Delivery Note":"Create Delivery Note"}),children:e.jsxs(q.div,{initial:{x:-500,opacity:0},animate:{opacity:1,x:0,transition:{type:"spring",stiffness:300,damping:40,duration:.4}},exit:{x:-700,transition:{duration:.2}},className:"  scrollbar-hide flex flex-col dark:text-white dark:bg-[#141625] bg-white my-5  md:pl-[50px] py-16 px-6 h-screen md:w-full md:rounded-r-3xl",children:[e.jsx("h1",{className:" font-semibold dark:text-white  text-3xl",children:s?"Edit Delivery Note":"Create Delivery Note"}),e.jsxs("form",{className:"overflow-y-scroll relative scrollbar-hide ",onSubmit:d.handleSubmit(I),children:[e.jsx("div",{className:"  ",children:e.jsxs("div",{className:" ",children:[e.jsx(b,{className:"my-5"}),e.jsxs("div",{className:" grid grid-cols-2   gap-3   ",children:[e.jsxs("div",{className:" mx-1 col-span-1",children:[e.jsx("span",{children:"Invoice Number"}),e.jsx("select",{labelPlacement:"outside",label:"Select Invoice",className:"bg-gray-100  mt-1 p-2 rounded-xl w-full border-none outline-none focus:ring-0",startContent:"⚅",...a("invoice"),children:_.map(t=>e.jsx("option",{value:t.id,children:t.number},t.id))})]}),e.jsxs("div",{className:"  col-span-1",children:[e.jsx("span",{children:"Client"}),e.jsx("select",{labelPlacement:"outside",label:"Client Name",className:"bg-gray-100  mt-1 p-2 rounded-xl w-full border-none outline-none focus:ring-0",startContent:"👤",...a("client"),children:C.map(t=>e.jsx("option",{value:t.id,children:t.company_name},t.id))})]})]}),e.jsxs("div",{className:" flex justify-center space-x-5 items-center mt-8 ",children:[e.jsx("div",{className:" flex-1  ",children:e.jsx(c,{title:"Delivery Note Date",type:"date",register:a,name:"date"})}),e.jsx("div",{className:"flex-1  ",children:e.jsx(c,{title:"Issue Date",type:"date",register:a,name:"issue_date"})})]}),e.jsx("div",{className:"py-3",children:e.jsx(c,{title:"Number",type:"text",register:a,name:"number"})}),e.jsx("h2",{className:" font-medium text-gray-500 mt-10 ",children:"Item List"}),e.jsx(b,{className:"my-5"}),y.map(({id:t},i)=>e.jsx("div",{className:" border-b pb-2 border-gray-300 mb-4 ",children:e.jsx(J,{handleRemove:D,getValues:g,control:d.control,index:i,name:`items.${i}.name`,register:a},i)},i)),e.jsx("div",{className:"flex flex-col   items-end",children:e.jsx("input",{type:"hidden",...a("issued_by",{value:n.user.id})})})]})}),e.jsxs("div",{className:"sticky space-y-4",children:[e.jsx(u,{onClick:()=>{S()},className:"  w-full mt-4",color:"primary",endContent:e.jsx(R,{}),children:"Add New Item"}),e.jsxs("div",{className:" flex  justify-between",children:[e.jsx("div",{children:e.jsx(u,{onClick:()=>{m()},className:"  ",color:"primary",children:"Discard"})}),e.jsx("div",{children:e.jsx(u,{className:"  ",color:"primary",type:"submit",isLoading:w,children:"Submit"})})]})]})]})]},"createDeliverynote-sidebar")})}export{M as default};
