import{b as O,u as Q,R as D,r as _,f as k,j as e,c as b,y as j}from"./app-7212a6bf.js";import{A as P,d as g,a as u}from"./AuthenticatedLayout-b19f68c4.js";import{I as R}from"./InvoiceField-160c441d.js";import{I as V,P as J}from"./PlusIcon-c384a506.js";import{u as L,a as U}from"./index.esm-120f0e97.js";import{m as z,b as p}from"./chunk-NXTXE2B3-6ae725e6.js";import"./transition-994c12ae.js";function q({auth:h,quotation:s}){const v=O(t=>t.customers.customers),f=Q();console.log("quotation :",s);const N=[{description:"",quantity:0,rate:0,amount:0}],m=L({defaultValues:{tpin:s?parseInt(s.tpin):0,date:s?s.date:new Date().toISOString().slice(0,10),subtotal:s?s.subtotal:0,total:s?s.total:0,vat:s?parseFloat(s.subtotal)*.16:0,items:s?JSON.parse(s.items):N}}),{fields:S,append:w,remove:I}=U({control:m.control,name:"items"}),{register:r,reset:x,setValue:n,getValues:o,handleSubmit:B}=m,A=(t,a)=>{const l=parseInt(a.target.value);n(`items.${t}.rate`,l);const i=o(`items.${t}.quantity`),c=o(`items.${t}.rate`),d=i*c;n(`items.${t}.amount`,d),y()},C=(t,a)=>{const l=parseInt(a.target.value);n(`items.${t}.quantity`,l);const i=o(`items.${t}.quantity`),c=o(`items.${t}.rate`),d=i*c;n(`items.${t}.amount`,d),y()},y=()=>{const a=o("items").reduce((c,d)=>c+d.amount,0);n("subtotal",a);const l=o("subtotal")+o("subtotal")*.16,i=o("subtotal")*.16;n("vat",i),n("total",l)},$=t=>{I(t)},E=()=>{w({description:"",quantity:0,rate:0,amount:0,id:""})},[T,G]=D.useState(!1),F=async t=>{if(s&&s.id){const a=new FormData;Object.entries(t).forEach(([l,i])=>{l==="items"&&Array.isArray(i)?a.append(l,JSON.stringify(i)):a.append(l,i)}),a.append("_method","PUT"),b.post(`/quotations/${s.id}/`,a).then(l=>{console.log("res :",l),u.success("Quotation Edited Successfully"),j.visit("/quotations"),x()}).catch(l=>{console.error("Error editing quotation:",l),u.error("Failed to edit quotation")})}else b.post("/quotations",t).then(a=>{u.success("Quotation Added Successfully"),j.visit("/quotations"),x()}).catch(a=>{console.error("Error adding quotation:",a),u.error("Failed to add quotation")})};return _.useEffect(()=>{f(k())},[f]),e.jsx(P,{user:h.user,header:e.jsxs("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:[s?"Edit":"Create"," Quotation"]}),children:e.jsxs(z.div,{initial:{x:-500,opacity:0},animate:{opacity:1,x:0,transition:{type:"spring",stiffness:300,damping:40,duration:.4}},exit:{x:-700,transition:{duration:.2}},className:"  scrollbar-hide flex flex-col dark:text-white dark:bg-[#141625] bg-white my-5  md:pl-[50px] py-16 px-6 h-screen md:w-full md:rounded-r-3xl",children:[e.jsxs("h1",{className:" font-semibold dark:text-white  text-3xl",children:[s?"Edit":"Create"," Quotation"]}),e.jsxs("form",{className:"overflow-y-scroll relative scrollbar-hide ",onSubmit:m.handleSubmit(F),children:[e.jsx("div",{className:"  ",children:e.jsxs("div",{className:" ",children:[e.jsx(g,{className:"my-5"}),e.jsx("div",{className:" grid grid-cols-1   gap-3   ",children:e.jsx("div",{className:"  col-span-1",children:e.jsx("select",{className:"bg-gray-100  mt-1 p-2 rounded-xl w-full border-none outline-none focus:ring-0",...r("tpin"),children:v.map(t=>e.jsx("option",{value:t.id,children:t.company_name},t.id))})})}),e.jsx("div",{className:" flex justify-center space-x-5 items-center mt-8 ",children:e.jsx("div",{className:" flex-1  ",children:e.jsx(V,{title:"Date",type:"date",register:r,name:"date"})})}),e.jsx("h2",{className:" font-medium text-gray-500 mt-10 ",children:"Item List"}),e.jsx(g,{className:"my-5"}),S.map(({id:t},a)=>e.jsx("div",{className:" border-b pb-2 border-gray-300 mb-4 ",children:e.jsx(R,{handleRemove:$,handlePriceChange:A,getValues:o,control:m.control,handleQuantityChange:C,index:a,name:`items.${a}.name`,register:r},a)},a)),e.jsxs("div",{className:"flex flex-col   items-end",children:[e.jsxs("div",{className:"flex flex-col ",children:[e.jsx("span",{className:"text-sm text-left",children:"Sub Total"}),e.jsx("input",{style:{border:"none",outline:"none",boxShadow:"none"},type:"text",readOnly:!0,className:"bg-gray-100 w-fit mt-1 p-2 rounded-xl",...r("subtotal")},"Sub Total")]}),e.jsxs("div",{className:"flex flex-col my-3",children:[e.jsx("span",{className:"text-sm text-left",children:"VAT (16%)"}),e.jsx("input",{style:{border:"none",outline:"none",boxShadow:"none"},type:"text",value:"16",readOnly:!0,className:"bg-gray-100 w-fit mt-1 p-2 rounded-xl",...r("vat")},"vat")]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm text-left",children:"Quotation Total"}),e.jsx("input",{style:{border:"none",outline:"none",boxShadow:"none"},readOnly:!0,className:"bg-gray-100 w-fit mt-1 p-2 rounded-xl",...r("total")},"invoiceTotal")]}),e.jsx("input",{type:"hidden",...r("issued_by",{value:h.user.id})})]})]})}),e.jsxs("div",{className:"sticky space-y-4",children:[e.jsx(p,{onClick:()=>{E()},className:"  w-full mt-4",color:"primary",endContent:e.jsx(J,{}),children:"Add New Item"}),e.jsxs("div",{className:" flex  justify-between",children:[e.jsx("div",{children:e.jsx(p,{onClick:()=>{x()},className:"  ",color:"primary",children:"Discard"})}),e.jsx("div",{children:e.jsx(p,{className:"  ",color:"primary",type:"submit",isLoading:T,children:s?"Update":"Create"})})]})]})]})]},"createQuote-sidebar")})}export{q as default};
