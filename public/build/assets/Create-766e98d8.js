import{j as e,u as g,R as A,r as D,f as E,i as G,b as p,c as u,y as j}from"./app-adc48ae7.js";import{A as I,d as y,a as m}from"./AuthenticatedLayout-a111fece.js";import{I as a}from"./InputText-e79ba361.js";import{P as O}from"./PlusIcon-bdee327a.js";import{u as F,a as $}from"./index.esm-4cef220c.js";import{j as q,b as f}from"./chunk-NXTXE2B3-1caf704e.js";function B({register:c,index:s,handleRemove:d,getValues:n}){return e.jsx("div",{children:e.jsxs("div",{className:" flex dark:text-white justify-between space-x-5 items-center",children:[e.jsxs("div",{className:" flex flex-wrap  w-full   ",children:[e.jsx("div",{className:" flex px-2   flex-1  flex-col items-start",children:e.jsx(a,{title:"Order Ref.",name:`items.${s}.order_ref`,register:c,errors:n().items[s].order_ref})}),e.jsx("div",{className:" flex px-2   flex-1  flex-col items-start",children:e.jsx(a,{title:"Quantity",name:`items.${s}.quantity`,register:c,errors:n().items[s].quantity})}),e.jsx("div",{className:" flex-1 flex px-2   flex-col  ",children:e.jsx("div",{className:" flex px-2   flex-1  flex-col items-start",children:e.jsx(a,{title:"Description",name:`items.${s}.description`,register:c,errors:n().items[s].description})})})]}),e.jsx("button",{className:"pt-8",onClick:()=>{d(s)},children:"🗑️"})]})})}function K({auth:c,goodsRecieved:s}){const d=g(),n=[{order_ref:"",description:"",quantity:0}],t=F({defaultValues:{reference:s?s.reference:"",order_ref:s?s.order_reference:"",received_by:s?s.received_by:"",checked_by:s?s.checked_by:"",goods_condition:s?s.goods_condition:"",date:s?s.date:new Date().toISOString().slice(0,10),items:s?JSON.parse(s.items):n}}),{fields:b,append:v,remove:N}=$({control:t.control,name:"items"}),{register:l,reset:h,setValue:P,getValues:S,handleSubmit:J}=t,_=i=>{N(i)},w=()=>{v({order_ref:"",description:"",quantity:0,id:""})},[C,L]=A.useState(!1),k=async i=>{if(s&&s.id){const r=new FormData;Object.entries(i).forEach(([o,x])=>{o==="items"&&Array.isArray(x)?r.append(o,JSON.stringify(x)):r.append(o,x)}),r.append("_method","PUT"),u.post(`/good-received/${s.id}`,r).then(o=>{m.success("Goods Received Edited Successfully"),h(),j.visit("/good-received")}).catch(o=>{console.error("Error editing goods received:",o),m.error("Failed to edit goods received")})}else u.post("/good-received",i).then(r=>{m.success("Goods Received Added Successfully"),j.visit("/good-received")}).catch(r=>{console.error("Error adding goods received:",r),m.error("Failed to add goods received")})};return D.useEffect(()=>{d(E()),d(G())},[d]),p(i=>i.customers.customers),p(i=>i.invoices.invoices),e.jsx(I,{user:c.user,header:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:s?"Edit Goods Receievd":"Create Goods Received"}),children:e.jsxs(q.div,{initial:{x:-500,opacity:0},animate:{opacity:1,x:0,transition:{type:"spring",stiffness:300,damping:40,duration:.4}},exit:{x:-700,transition:{duration:.2}},className:"  scrollbar-hide flex flex-col dark:text-white dark:bg-[#141625] bg-white my-5  md:pl-[50px] py-16 px-6 h-screen md:w-full md:rounded-r-3xl",children:[e.jsx("h1",{className:" font-semibold dark:text-white  text-3xl",children:s?"Edit Goods Receievd":"Create Goods Received"}),e.jsxs("form",{className:"overflow-y-scroll relative scrollbar-hide ",onSubmit:t.handleSubmit(k),children:[e.jsx("div",{className:"  ",children:e.jsxs("div",{className:" ",children:[e.jsx(y,{className:"my-5"}),e.jsx("div",{className:" grid grid-cols-2   gap-5   "}),e.jsxs("div",{className:" flex justify-center mb-5 space-x-5 items-center mt-8 ",children:[e.jsx("div",{className:" flex-1  ",children:e.jsx(a,{label:"Reference",name:"reference",register:l,title:"Reference",errors:t.formState.errors})}),e.jsx("div",{className:"flex-1  ",children:e.jsx(a,{label:"Order Reference",name:"order_ref",register:l,title:"Order Reference",errors:t.formState.errors})})]}),e.jsx("div",{className:"flex-1 pt-3  ",children:e.jsx(a,{label:"Date",name:"date",type:"date",register:l,title:"Date",errors:t.formState.errors})}),e.jsxs("div",{className:" flex justify-center mb-5 space-x-5 items-center mt-8 ",children:[e.jsx("div",{className:" flex-1  ",children:e.jsx(a,{label:"Received By",name:"received_by",register:l,title:"Received By",errors:t.formState.errors})}),e.jsx("div",{className:"flex-1  ",children:e.jsx(a,{label:"Checked By",name:"checked_by",register:l,title:"Checked By",errors:t.formState.errors})})]}),e.jsx("div",{className:"flex-1 pt-3  ",children:e.jsx(a,{label:"Goods Condition",name:"goods_condition",register:l,title:"Goods Condition",errors:t.formState.errors})}),e.jsx("h2",{className:" font-medium text-gray-500 mt-10 ",children:"Item List"}),e.jsx(y,{className:"my-5"}),b.map(({id:i},r)=>e.jsx("div",{className:" border-b pb-2 border-gray-300 mb-4 ",children:e.jsx(B,{handleRemove:_,getValues:S,control:t.control,index:r,name:`items.${r}.name`,register:l},r)},r)),e.jsx("div",{className:"flex flex-col   items-end",children:e.jsx("input",{type:"hidden",...l("issued_by",{value:c.user.id})})})]})}),e.jsxs("div",{className:"sticky space-y-4",children:[e.jsx(f,{onClick:()=>{w()},className:"  w-full mt-4",color:"primary",endContent:e.jsx(O,{}),children:"Add New Item"}),e.jsxs("div",{className:" flex  justify-between",children:[e.jsx("div",{children:e.jsx(f,{onClick:()=>{h()},className:"  ",color:"primary",children:"Discard"})}),e.jsx("div",{children:e.jsx(f,{className:"  ",color:"primary",type:"submit",isLoading:C,children:"Submit"})})]})]})]})]},"createDeliverynote-sidebar")})}export{K as default};
