import{u as O,R as P,r as R,f as V,b as k,j as e,a as J,c as j,y as g}from"./app-11892417.js";import{A as L,d as v,a as u}from"./AuthenticatedLayout-ea713bc5.js";import{I as M}from"./InvoiceField-a0dc208c.js";import{u as U,a as B}from"./index.esm-567c264d.js";import{I as N}from"./InputText-3daa13b6.js";import{j as Q,b as _}from"./chunk-NXTXE2B3-70279433.js";function te({auth:f,invoice:s,deliveryNotes:x}){const b=O();console.log("notes",x);const S=[{description:"",quantity:0,rate:0,amount:0}],p=U({defaultValues:{invoiceNumber:s&&s.number?s.number:0,client:s&&s.customer?s.customer:0,date:s&&s.date?s.date:new Date().toISOString().slice(0,10),due_date:s&&s.due_date?s.due_date:new Date().toISOString().slice(0,10),delivery_note:s&&s.delivery_note?s.delivery_note:"",subtotal:s&&s.subtotal?s.subtotal:0,invoicetotal:s&&s.total?s.total:0,items:s&&s.line_items?JSON.parse(s.line_items):S,vat:s&&s.vat?s.vat:0}}),{register:c,reset:h,setValue:n,getValues:o,handleSubmit:z}=p,{fields:I,append:G,remove:w}=B({control:p.control,name:"items"}),C=(t,l)=>{if(!parseFloat(l.target.value)){u.error("Please enter a valid number");return}const a=l.target.value;n(`items.${t}.rate`,a);const r=o(`items.${t}.quantity`),d=o(`items.${t}.rate`),m=i(r*parseFloat(d),3);n(`items.${t}.amount`,m),y()},$=t=>{if(!o("items.0.quantity")){u.error("Please enter quantity first");return}const a=parseFloat(t.target.value),r=i(parseFloat(a)*100/116,2),d=i(parseFloat(a)-r,2),m=i(r/o("items.0.quantity"),3);n("items.0.rate",m),n("items.0.amount",r),n("subtotal",r),n("invoicetotal",a),n("vat",d)},D=(t,l)=>{const a=parseInt(l.target.value);n(`items.${t}.quantity`,a);const r=o(`items.${t}.quantity`),d=o(`items.${t}.rate`),m=i(r*d,3);n(`items.${t}.amount`,m),y()},i=(t,l)=>{const a=Math.pow(10,l);return Math.round(t*a)/a},y=()=>{const t=o("items"),l=i(t.reduce((d,m)=>d+m.amount,0),3);n("subtotal",l);const a=i(o("subtotal")+o("subtotal")*.16,3),r=i(o("subtotal")*.16,2);n("vat",r),n("invoicetotal",a)},q=t=>{w(t)},[F,H]=P.useState(!1),T=(t,l)=>{const a=x.find(r=>r.delivery_note_number===l);console.log("deliveryNote:",a),a&&(n("delivery_note",a.delivery_note_number),n("client",a.customer_id),n(`items.${t}.description`,a.description),n(`items.${t}.quantity`,a.quantity))},A=async t=>{if(s&&s.id){const l=new FormData;Object.entries(t).forEach(([a,r])=>{a==="items"&&Array.isArray(r)?l.append(a,JSON.stringify(r)):l.append(a,r)}),l.append("_method","PUT"),j.post(`/invoices/${s.id}`,l).then(a=>{console.log("res:",a),u.success("Invoice Edited Successfully"),h(),g.visit("/invoices")}).catch(a=>{console.error("err:",a),u.error("Failed to edit the Invoice")})}else j.post("/invoices",t).then(l=>{u.success("Invoice Added Successfully"),g.visit("/invoices"),h()}).catch(l=>{console.error("err:",l),u.error("Failed to create an Invoice")})};R.useEffect(()=>{b(V())},[b]);const E=k(t=>t.customers.customers);return e.jsxs(L,{user:f.user,header:e.jsxs("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:[s?"Edit":"Create"," Invoice"]}),children:[e.jsx(J,{title:s?"Edit":"Create"}),e.jsxs(Q.div,{initial:{x:-500,opacity:0},animate:{opacity:1,x:0,transition:{type:"spring",stiffness:300,damping:40,duration:.4}},exit:{x:-700,transition:{duration:.2}},className:"  scrollbar-hide flex flex-col dark:text-white dark:bg-[#141625] bg-white my-5  md:pl-[50px] py-8 px-6  md:w-full md:rounded-r-3xl",children:[e.jsxs("h1",{className:" font-semibold dark:text-white  text-3xl",children:[s?"Edit":"Create"," Invoice"]}),e.jsxs("form",{className:"overflow-y-scroll relative scrollbar-hide ",onSubmit:p.handleSubmit(A),children:[e.jsx("div",{className:"  ",children:e.jsxs("div",{className:" ",children:[e.jsx("h1",{className:"my-4 mt-5 font-medium",children:"Bill To"}),e.jsx(v,{className:"my-5"}),e.jsx("div",{className:" grid grid-cols-1   gap-3   ",children:e.jsxs("div",{className:"  col-span-1",children:[e.jsx("span",{children:"Client"}),e.jsxs("select",{labelPlacement:"outside",label:"Client Name",className:"bg-gray-100  mt-1 p-2 rounded-xl w-full border-none outline-none focus:ring-0",startContent:"ðŸ‘¤",...c("client"),disabled:!0,children:[e.jsx("option",{value:""}),E.map(t=>e.jsx("option",{value:t.id,children:t.company_name},t.id))]})]})}),e.jsxs("div",{className:" flex justify-center space-x-5 items-center mt-8 ",children:[e.jsx("div",{className:" flex-1  ",children:e.jsx(N,{title:"Date ",className:"flex-1",type:"date",register:c,name:"date"})}),e.jsx("div",{className:"flex-1  ",children:e.jsx(N,{title:"Due Date",className:"flex-1",type:"date",register:c,name:"due_date"})})]}),e.jsx("div",{className:" grid grid-cols-1   gap-3 mt-5   ",children:e.jsxs("div",{className:"  col-span-1",children:[e.jsx("span",{children:"Delivery Note Number"}),e.jsxs("select",{labelPlacement:"outside",label:"Delivery Note",onChange:t=>T(0,t.target.value),className:"bg-gray-100  mt-1 p-2 rounded-xl w-full border-none outline-none focus:ring-0",startContent:"ðŸ‘¤",children:[e.jsx("option",{value:"",children:"Select Delivery Note"}),x==null?void 0:x.map(t=>e.jsx("option",{value:t.delivery_note_number,children:t.delivery_note_number},t.delivery_note_number))]})]})}),e.jsx("h2",{className:" font-medium text-gray-500 mt-10 ",children:"Item List"}),e.jsx(v,{className:"my-5"}),I.map(({id:t},l)=>e.jsx("div",{className:" border-b pb-2 border-gray-300 mb-4 ",children:e.jsx(M,{handleRemove:q,handlePriceChange:C,getValues:o,control:p.control,handleQuantityChange:D,index:l,name:`items.${l}.name`,register:c},l)},l)),e.jsxs("div",{className:"flex    justify-end  items-center space-x-3 ",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm float-left",children:"Sub Total"}),e.jsx("input",{style:{border:"none",outline:"none",boxShadow:"none"},type:"text",readOnly:!0,className:"bg-gray-100  mt-1 p-2 rounded-xl w-fit float-right",...c("subtotal")},"Sub Total")]}),e.jsxs("div",{className:"flex my-3 flex-col",children:[e.jsx("span",{className:"text-sm text-left",children:"VAT (16%)"}),e.jsx("input",{style:{border:"none",outline:"none",boxShadow:"none"},type:"text",readOnly:!0,className:" bg-gray-100 w-fit mt-1 p-2 rounded-xl  float-right",...c("vat")},"vat")]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm",children:"Invoice Totall"}),e.jsx("input",{style:{border:"none",outline:"none",boxShadow:"none"},onChange:t=>$(t),className:"bg-gray-100 w-fit mt-1 p-2 rounded-xl float-right"},"invoiceTotal")]}),e.jsx("input",{type:"hidden",...c("issued_by",{value:f.user.id})})]})]})}),e.jsxs("div",{className:"sticky space-y-4",children:[e.jsx("hr",{}),e.jsxs("div",{className:" flex  justify-end gap-3",children:[e.jsx("div",{children:e.jsx(_,{onClick:()=>{h()},className:"  ",color:"primary",children:"Discard"})}),e.jsx("div",{children:e.jsx(_,{className:"  ",color:"primary",type:"submit",isLoading:F,children:s?"Update":"Create"})})]})]})]})]},"createInvoice-sidebar")]})}export{te as default};
