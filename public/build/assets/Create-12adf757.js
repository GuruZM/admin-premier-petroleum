import{b as _,u as D,R as Q,r as O,f as P,j as e,a as R,c as b,y as j}from"./app-8f4d3859.js";import{A as V,d as g,a as u}from"./AuthenticatedLayout-7f460c47.js";import{I as k}from"./InvoiceField-22fcee6f.js";import{u as J,a as L}from"./index.esm-646e44cc.js";import{I as M}from"./InputText-9e52dc82.js";import{j as U,b as v}from"./chunk-NXTXE2B3-260b1d2b.js";function ee({auth:h,quotation:a}){const N=_(t=>t.customers.customers),f=D();console.log("quotation :",a);const S=[{description:"",quantity:0,rate:0,amount:0}],d=(t,s)=>{const o=Math.pow(10,s);return Math.round(t*o)/o},x=J({defaultValues:{customer_id:a?parseInt(a.customer_id):0,date:a?a.date:new Date().toISOString().slice(0,10),subtotal:a?a.subtotal:0,total:a?a.total:0,vat:a?parseFloat(a.vat):0,items:a?JSON.parse(a.items):S}}),{fields:w,append:q,remove:$}=L({control:x.control,name:"items"}),{register:m,data:z,reset:p,setValue:n,getValues:i,handleSubmit:B}=x,C=(t,s)=>{const o=parseFloat(s.target.value);n(`items.${t}.rate`,o);const r=i(`items.${t}.quantity`),l=i(`items.${t}.rate`),c=d(r*l,3);n(`items.${t}.amount`,c),y()},F=(t,s)=>{const o=parseInt(s.target.value);n(`items.${t}.quantity`,o);const r=i(`items.${t}.quantity`),l=i(`items.${t}.rate`),c=d(r*l,3);n(`items.${t}.amount`,c),y()},I=t=>{if(!i("items.0.quantity")){u.error("Please enter quantity first");return}const o=parseFloat(t.target.value),r=d(parseFloat(o)*100/116,2),l=d(parseFloat(o)-r,3),c=d(r/i("items.0.quantity"),3);console.log("vat",l),console.log("rate",c),n("items.0.rate",c),n("items.0.amount",r),n("subtotal",r),n("vat",l),n("total",o)},y=()=>{const s=i("items").reduce((l,c)=>l+c.amount,0);n("subtotal",s);const o=i("subtotal")+i("subtotal")*.16,r=d(i("subtotal")*.16,2);n("vat",r),n("total",o)},E=t=>{$(t)},[T,G]=Q.useState(!1),A=async t=>{if(a&&a.id){const s=new FormData;Object.entries(t).forEach(([o,r])=>{o==="items"&&Array.isArray(r)?s.append(o,JSON.stringify(r)):s.append(o,r)}),s.append("_method","PUT"),b.post(`/quotations/${a.id}/`,s).then(o=>{u.success("Quotation Edited Successfully"),j.visit("/quotations"),p()}).catch(o=>{console.error("Error editing quotation:",o),u.error("Failed to edit quotation")})}else b.post("/quotations",t).then(s=>{u.success("Quotation Added Successfully"),j.visit("/quotations"),p()}).catch(s=>{console.error("Error adding quotation:",s),u.error("Failed to add quotation")})};return O.useEffect(()=>{f(P())},[f]),e.jsxs(V,{user:h.user,header:e.jsxs("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:[a?"Edit":"Create"," Quotation"]}),children:[e.jsx(R,{title:a?"Edit":"Create"}),e.jsxs(U.div,{initial:{x:-500,opacity:0},animate:{opacity:1,x:0,transition:{type:"spring",stiffness:300,damping:40,duration:.4}},exit:{x:-700,transition:{duration:.2}},className:"  scrollbar-hide flex flex-col dark:text-white dark:bg-[#141625] bg-white my-5  md:pl-[50px] py-16 px-6 h-fit md:w-full md:rounded-r-3xl",children:[e.jsxs("h1",{className:" font-semibold dark:text-white  text-3xl",children:[a?"Edit":"Create"," Quotation"]}),e.jsxs("form",{className:"overflow-y-scroll relative scrollbar-hide ",onSubmit:x.handleSubmit(A),children:[e.jsx("div",{className:"  ",children:e.jsxs("div",{className:" ",children:[e.jsx(g,{className:"my-5"}),e.jsx("div",{className:" grid grid-cols-1   gap-3   ",children:e.jsx("div",{className:"  col-span-1",children:e.jsx("select",{type:"number",className:"bg-gray-100  mt-1 p-2 rounded-xl w-full border-none outline-none focus:ring-0",...m("customer_id"),children:N.map(t=>e.jsx("option",{value:t.id,children:t.company_name},t.id))})})}),e.jsx("div",{className:" flex justify-center space-x-5 items-center mt-8 ",children:e.jsx("div",{className:" flex-1  ",children:e.jsx(M,{title:"Date",type:"date",register:m,name:"date"})})}),e.jsx("h2",{className:" font-medium text-gray-500 mt-10 ",children:"Item List"}),e.jsx(g,{className:"my-5"}),w.map(({id:t},s)=>e.jsx("div",{className:" border-b pb-2 border-gray-300 mb-4 ",children:e.jsx(k,{handleRemove:E,handlePriceChange:C,getValues:i,control:x.control,handleQuantityChange:F,index:s,name:`items.${s}.name`,register:m},s)},s)),e.jsxs("div",{className:"flex sm:flex-row  flex-col justify-end gap-3  items-center",children:[e.jsxs("div",{className:"flex flex-col ",children:[e.jsx("span",{className:"text-sm text-left",children:"Sub Total"}),e.jsx("input",{style:{border:"none",outline:"none",boxShadow:"none"},type:"text",readOnly:!0,className:"bg-gray-100 w-fit mt-1 p-2 rounded-xl",...m("subtotal")},"Sub Total")]}),e.jsxs("div",{className:"flex flex-col my-3",children:[e.jsx("span",{className:"text-sm text-left",children:"VAT (16%).."}),e.jsx("input",{style:{border:"none",outline:"none",boxShadow:"none"},type:"text",readOnly:!0,className:"bg-gray-100 w-fit mt-1 p-2 rounded-xl",...m("vat")},"vat")]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm text-left",children:"Quotation Total"}),e.jsx("input",{style:{border:"none",outline:"none",boxShadow:"none"},onChange:t=>I(t),className:"bg-gray-100 w-fit mt-1 p-2 rounded-xl"},"total")]}),e.jsx("input",{type:"hidden",...m("issued_by",{value:h.user.id})})]})]})}),e.jsxs("div",{className:"sticky space-y-4",children:[e.jsx("hr",{}),e.jsxs("div",{className:" flex  justify-end gap-4",children:[e.jsx("div",{children:e.jsx(v,{onClick:()=>{p()},className:"  ",color:"primary",children:"Discard"})}),e.jsx("div",{children:e.jsx(v,{className:"  ",color:"primary",type:"submit",isLoading:T,children:a?"Update":"Create"})})]})]})]})]},"createQuote-sidebar")]})}export{ee as default};
