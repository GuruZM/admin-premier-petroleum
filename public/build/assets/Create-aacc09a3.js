import{j as e,u as _,R as E,r as A,f as C,i as F,b as h,c as j,y as v}from"./app-396de1cd.js";import{A as O,d as b,a as d}from"./AuthenticatedLayout-6178460a.js";import{I as m}from"./InputText-d8ce4c5d.js";import{u as k,a as R}from"./index.esm-0bbaf095.js";import{j as V,b as y}from"./chunk-NXTXE2B3-af8b5c1c.js";function $({register:l,index:s,handleRemove:n,getValues:r}){return e.jsx("div",{children:e.jsx("div",{className:" flex dark:text-white justify-between space-x-5 items-center",children:e.jsxs("div",{className:" flex flex-wrap  w-full   ",children:[e.jsx("div",{className:" flex-1 flex px-2   flex-col  ",children:e.jsx("div",{className:" flex px-2   flex-1  flex-col items-start",children:e.jsx(m,{title:"Description",type:"text",register:l,name:`items.${s}.description`})})}),e.jsx("div",{className:" flex px-2   flex-1  flex-col items-start",children:e.jsx(m,{title:"Qty",type:"number",register:l,name:`items.${s}.quantity`})})]})})})}function B({auth:l,deliveryNote:s}){const n=_(),r=k({defaultValues:{invoice:s?s.invoice_id:0,client:s?s.client_id:0,date:s?s.date:new Date().toISOString().slice(0,10),issue_date:s?s.issue_date:new Date().toISOString().slice(0,10),number:s?s.number:"",items:s?JSON.parse(s.items):[]}}),{fields:g,append:J,remove:N}=R({control:r.control,name:"items"}),{register:c,reset:x,setValue:o,getValues:p,handleSubmit:L}=r,S=i=>{N(i)},D=i=>{const t=u.filter(a=>a.id===parseInt(i))[0];t&&(o("invoice",t.id),o("client",t.customer),o("number",t.track_details),o("items",JSON.parse(t.line_items))),console.log("items :",p("items"))},[I,P]=E.useState(!1),w=async i=>{if(s&&s.id){const t=new FormData;Object.entries(i).forEach(([a,f])=>{a==="items"&&Array.isArray(f)?t.append(a,JSON.stringify(f)):t.append(a,f)}),t.append("_method","PUT"),j.post(`/delivery-notes/${s.id}`,t).then(a=>{d.success("Delivery Note Edited Successfully"),x(),v.visit("/delivery-notes")}).catch(a=>{console.error("Error editing delivery note:",a),d.error("Failed to edit delivery note")})}else j.post("/delivery-notes",i).then(t=>{d.success("Delivery Note Added Successfully"),x(),v.visit("/delivery-notes")}).catch(t=>{console.error("Error adding delivery note:",t),d.error("Failed to add delivery note")})};A.useEffect(()=>{n(C()),n(F())},[n]),h(i=>i.customers.customers);const u=h(i=>i.invoices.invoices);return console.log("invoices",u),e.jsx(O,{user:l.user,header:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:s?"Edit Delivery Note":"Create Delivery Note"}),children:e.jsxs(V.div,{initial:{x:-500,opacity:0},animate:{opacity:1,x:0,transition:{type:"spring",stiffness:300,damping:40,duration:.4}},exit:{x:-700,transition:{duration:.2}},className:"  scrollbar-hide flex flex-col dark:text-white dark:bg-[#141625] bg-white my-5  md:pl-[50px] py-16 px-6 h-fit md:w-full md:rounded-r-3xl",children:[e.jsx("h1",{className:" font-semibold dark:text-white  text-3xl",children:s?"Edit Delivery Note":"Create Delivery Note"}),e.jsxs("form",{className:"overflow-y-scroll relative scrollbar-hide ",onSubmit:r.handleSubmit(w),children:[e.jsx("div",{className:"  ",children:e.jsxs("div",{className:" ",children:[e.jsx(b,{className:"my-5"}),e.jsx("div",{className:" grid grid-cols-1   gap-3   ",children:e.jsxs("div",{className:" mx-1 col-span-1",children:[e.jsx("span",{children:"Invoice Number"}),e.jsx("select",{labelPlacement:"outside",label:"Select Invoice",className:"bg-gray-100  mt-1 p-2 rounded-xl w-full border-none outline-none focus:ring-0",startContent:"âš…",onChange:i=>D(i.target.value),children:u.map(i=>e.jsx("option",{value:i.id,children:i.number},i.id))})]})}),e.jsxs("div",{className:" flex justify-center space-x-5 items-center mt-8 ",children:[e.jsx("div",{className:" flex-1  ",children:e.jsx(m,{title:"Delivery Note Date",type:"date",register:c,name:"date"})}),e.jsx("div",{className:"flex-1  ",children:e.jsx(m,{title:"Issue Date",type:"date",register:c,name:"issue_date"})})]}),e.jsx("h2",{className:" font-medium text-gray-500 mt-10 ",children:"Item List"}),e.jsx(b,{className:"my-5"}),g.map(({id:i},t)=>e.jsx("div",{className:" border-b pb-2 border-gray-300 mb-4 ",children:e.jsx($,{handleRemove:S,getValues:p,control:r.control,index:t,name:`items.${t}.name`,register:c},t)},t)),e.jsx("div",{className:"flex flex-col   items-end",children:e.jsx("input",{type:"hidden",...c("issued_by",{value:l.user.id})})})]})}),e.jsx("div",{className:"sticky space-y-4",children:e.jsxs("div",{className:" flex  justify-end gap-4",children:[e.jsx("div",{children:e.jsx(y,{onClick:()=>{x()},className:"  ",color:"primary",children:"Discard"})}),e.jsx("div",{children:e.jsx(y,{className:"  ",color:"primary",type:"submit",isLoading:I,children:"Submit"})})]})})]})]},"createDeliverynote-sidebar")})}export{B as default};
